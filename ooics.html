<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>C# Bindings for HybMesh &#8212; HybMesh 0.5.1 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.5.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Native File Formats" href="fileformats.html" />
    <link rel="prev" title="Matlab Bindings for HybMesh" href="ooimatlab.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="fileformats.html" title="Native File Formats"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ooimatlab.html" title="Matlab Bindings for HybMesh"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">HybMesh 0.5.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="oointerface.html" accesskey="U">High-Level Programming Interfaces</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="c-bindings-for-hybmesh">
<h1>C# Bindings for HybMesh<a class="headerlink" href="#c-bindings-for-hybmesh" title="Permalink to this headline">¶</a></h1>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>C# wrapper includes <em>Hybmesh.cs</em> source file and <em>core_hmconnection_cs</em>
library. Copy source file to your application directory and
add it into your project in order to use it.</p>
<p>Assign static properties</p>
<div class="highlight-C#"><div class="highlight"><pre><span></span><span class="n">Hybmesh</span><span class="p">.</span><span class="n">hybmesh_exec_path</span> <span class="p">=</span> <span class="s">&quot;directory/containing/hybmesh&quot;</span><span class="p">;</span>
<span class="n">Hybmesh</span><span class="p">.</span><span class="n">hybmesh_lib_path</span> <span class="p">=</span> <span class="s">&quot;directory/containing/core_hmconnection_cs&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>prior to first <strong>Hybmesh</strong> instance creation to define
custom paths if they differ from default ones given in <em>Hybmesh.cs</em> file.</p>
<p>Besides basic geometrical and exception classes
Hybmesh superclass also provides 2 additional nested classes defining 2D
and 3D Point which are used to pass point arguments to hybmesh methods.</p>
<p><strong>Hybmesh</strong> superclass implements <em>IDisposable</em> interface and
could be used within C# using statement</p>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">hm</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Hybmesh</span><span class="p">()){</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This will close background hybmesh application immediately when
the block ends. Otherwise it will wait for garbage collector.</p>
<p>C# accepts only compile time constants as default function arguments.
As a result it is impossible to add default arrays (even empty arrays) to
function signatures. In those cases Hybmesh C# wrapper uses
<em>null</em> values which are treated as predefined defaults.
Arguments which provide <em>null</em> default values are listed in
respective function xml docs.</p>
<p>This is an example of a function
signature with default <em>null</em> as it appears in <em>Hybmesh.cs</em> file:</p>
<div class="highlight-C#"><div class="highlight"><pre><span></span><span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// Creates singly connected contour as a parametric cubic spline.</span>
<span class="c1">/// See details in hybmeshpack.hmscript.create_spline_contour().</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="c1">/// &lt;param name=&quot;bnds&quot;&gt;if null then int[] {0}&lt;/param&gt;</span>
<span class="k">public</span> <span class="n">Contour2D</span> <span class="nf">CreateSplineContour</span><span class="p">(</span><span class="n">Point2</span><span class="p">[]</span> <span class="n">points</span><span class="p">,</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">bnds</span><span class="p">=</span><span class="k">null</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nedges</span><span class="p">=</span><span class="m">100</span><span class="p">){</span>
    <span class="n">bnds</span> <span class="p">=</span> <span class="n">bnds</span> <span class="p">??</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[]</span> <span class="p">{</span><span class="m">0</span><span class="p">};</span>
    <span class="c1">//....</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here if <strong>bnds</strong> argument is given as <em>null</em> it will be reassigned to <code class="docutils literal"><span class="pre">int[]</span> <span class="pre">{0}</span></code> array.</p>
<p>For detailed description of all methods consult
<a class="reference internal" href="oointerface.html#ooifuncref"><span class="std std-ref">python wrapper reference</span></a>
and embedded documentation of <code class="docutils literal"><span class="pre">Hybmesh.cs</span></code> source file.</p>
</div>
<div class="section" id="helloworld-example">
<h2>Helloworld Example<a class="headerlink" href="#helloworld-example" title="Permalink to this headline">¶</a></h2>
<p>Install hybmesh. Create an empty directory. Copy <em>Hybmesh.cs</em> into that directory.
Create the following file and place it there too.</p>
<div class="literal-block-wrapper container" id="id1">
<div class="code-block-caption"><span class="caption-text">Test.cs</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Test</span><span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(){</span>
        <span class="k">using</span> <span class="p">(</span><span class="n">Hybmesh</span> <span class="n">hm</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Hybmesh</span><span class="p">()){</span>
            <span class="n">Hybmesh</span><span class="p">.</span><span class="n">Grid2D</span> <span class="n">g</span> <span class="p">=</span> <span class="n">hm</span><span class="p">.</span><span class="n">AddUnfRectGrid</span><span class="p">(</span>
                    <span class="k">new</span> <span class="n">Hybmesh</span><span class="p">.</span><span class="n">Point2</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span>
                    <span class="k">new</span> <span class="n">Hybmesh</span><span class="p">.</span><span class="n">Point2</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span>
                    <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;number of cells: {0}&quot;</span><span class="p">,</span> <span class="n">g</span><span class="p">.</span><span class="n">Dims</span><span class="p">()[</span><span class="m">2</span><span class="p">]));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>To compile it with Mono execute in terminal</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; mcs Test.cs Hybmesh.cs
&gt;&gt;&gt; mono Test.exe
</pre></div>
</div>
<p>With VisualStudio compiler run Developer Command Prompt and invoke</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; csc Test.cs Hybmesh.cs
&gt;&gt;&gt; Test.exe
</pre></div>
</div>
</div>
<div class="section" id="introductory-example">
<span id="csintro"></span><h2>Introductory Example<a class="headerlink" href="#introductory-example" title="Permalink to this headline">¶</a></h2>
<p>The present example Winforms application builds
two regular rectangular grids and performs their
<a class="reference internal" href="functionality.html#gridimp"><span class="std std-ref">superposition</span></a> with user defined parameters.
Callback with cancellation support popup dialog
is used for grid union operation.</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/monoexample.png"><img alt="_images/monoexample.png" src="_images/monoexample.png" style="width: 600px;" /></a>
</div>
<p>To compile this example create a directory
containing <em>app.cs</em> file listed below along
with <em>Hybmesh.cs</em> wrapper file.
On Linux systems execute the following commands
(you will need <code class="docutils literal"><span class="pre">mono-winforms</span></code> libraries)</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; mcs app.cs Hybmesh.cs -r:System.Windows.Forms.dll -r:System.Drawing.dll
&gt;&gt;&gt; mono app.exe
</pre></div>
</div>
<p>On Windows use VisualStudio Developer Command Prompt</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&gt;&gt;&gt; csc app.cs Hybmesh.cs
&gt;&gt;&gt; app.exe
</pre></div>
</div>
<p>Hybmesh function call with progress bar dialog
is provided by <em>AppGui.ProgressBarExecutor.Exec()</em> static method.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">For illustration and testing purposes callback function of current
application is intentionally delayed by
<em>AppGui.ProgressBarExecutor.CBForm.Callback()</em>
function. This delay could be safely removed.</p>
</div>
<div class="literal-block-wrapper container" id="id2">
<div class="code-block-caption"><span class="caption-text">app.cs</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c#"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Windows.Forms</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Drawing</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Drawing.Drawing2D</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.ComponentModel</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ExecutorFunc</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Action</span><span class="p">&lt;</span><span class="n">Hybmesh</span><span class="p">.</span><span class="n">DCallback</span><span class="p">&gt;;</span>
<span class="k">using</span> <span class="nn">P2</span> <span class="p">=</span> <span class="n">Hybmesh</span><span class="p">.</span><span class="n">Point2</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">App</span><span class="p">{</span>
    <span class="c1">/// &lt;summary&gt; Entry point &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(){</span>
        <span class="c1">//create grid storage</span>
        <span class="n">Builder</span> <span class="n">builder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Builder</span><span class="p">();</span>
        <span class="c1">//gui loop</span>
        <span class="n">Application</span><span class="p">.</span><span class="n">EnableVisualStyles</span><span class="p">();</span>  <span class="c1">// to let marquee progress bar work</span>
        <span class="n">Application</span><span class="p">.</span><span class="n">Run</span><span class="p">(</span><span class="k">new</span> <span class="n">AppGui</span><span class="p">.</span><span class="n">MainForm</span><span class="p">(</span><span class="n">builder</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; Holds properties of regular rectangular grid &lt;/summary&gt;</span>
<span class="k">class</span> <span class="nc">GridProps</span><span class="p">{</span>
    <span class="kt">double</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">;</span>
    <span class="k">public</span> <span class="nf">GridProps</span><span class="p">(</span><span class="kt">int</span> <span class="n">nx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ny</span><span class="p">,</span> <span class="kt">double</span> <span class="n">x0</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y0</span><span class="p">,</span> <span class="kt">double</span> <span class="n">x1</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y1</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="n">nx</span> <span class="p">=</span> <span class="n">nx</span><span class="p">;</span> <span class="k">this</span><span class="p">.</span><span class="n">ny</span> <span class="p">=</span> <span class="n">ny</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">x0</span> <span class="p">=</span> <span class="n">x0</span><span class="p">;</span> <span class="k">this</span><span class="p">.</span><span class="n">y0</span> <span class="p">=</span> <span class="n">y0</span><span class="p">;</span> <span class="k">this</span><span class="p">.</span><span class="n">x1</span> <span class="p">=</span> <span class="n">x1</span><span class="p">;</span> <span class="k">this</span><span class="p">.</span><span class="n">y1</span> <span class="p">=</span> <span class="n">y1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="kt">double</span> <span class="n">XMin</span><span class="p">{</span> <span class="k">get</span><span class="p">{</span> <span class="k">return</span> <span class="n">x0</span><span class="p">;</span> <span class="p">}</span> <span class="k">set</span><span class="p">{</span> <span class="n">x0</span> <span class="p">=</span> <span class="k">value</span><span class="p">;}</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">double</span> <span class="n">XMax</span><span class="p">{</span> <span class="k">get</span><span class="p">{</span> <span class="k">return</span> <span class="n">x1</span><span class="p">;</span> <span class="p">}</span> <span class="k">set</span><span class="p">{</span> <span class="n">x1</span> <span class="p">=</span> <span class="k">value</span><span class="p">;}</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">double</span> <span class="n">YMin</span><span class="p">{</span> <span class="k">get</span><span class="p">{</span> <span class="k">return</span> <span class="n">y0</span><span class="p">;</span> <span class="p">}</span> <span class="k">set</span><span class="p">{</span> <span class="n">y0</span> <span class="p">=</span> <span class="k">value</span><span class="p">;}</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">double</span> <span class="n">YMax</span><span class="p">{</span> <span class="k">get</span><span class="p">{</span> <span class="k">return</span> <span class="n">y1</span><span class="p">;</span> <span class="p">}</span> <span class="k">set</span><span class="p">{</span> <span class="n">y1</span> <span class="p">=</span> <span class="k">value</span><span class="p">;}</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Nx</span><span class="p">{</span> <span class="k">get</span><span class="p">{</span> <span class="k">return</span> <span class="n">nx</span><span class="p">;</span> <span class="p">}</span> <span class="k">set</span><span class="p">{</span> <span class="n">nx</span> <span class="p">=</span> <span class="k">value</span><span class="p">;}</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Ny</span><span class="p">{</span> <span class="k">get</span><span class="p">{</span> <span class="k">return</span> <span class="n">ny</span><span class="p">;</span> <span class="p">}</span> <span class="k">set</span><span class="p">{</span> <span class="n">ny</span> <span class="p">=</span> <span class="k">value</span><span class="p">;}</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; Holds properties of unite operation &lt;/summary&gt;</span>
<span class="k">class</span> <span class="nc">UniteProps</span><span class="p">{</span>
    <span class="kt">double</span> <span class="n">buffer</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">fix_bnd</span><span class="p">;</span>
    <span class="k">public</span> <span class="nf">UniteProps</span><span class="p">(</span><span class="kt">double</span> <span class="n">buffer</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">fix_bnd</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="n">buffer</span> <span class="p">=</span> <span class="n">buffer</span><span class="p">;</span> <span class="k">this</span><span class="p">.</span><span class="n">fix_bnd</span> <span class="p">=</span> <span class="n">fix_bnd</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="kt">double</span> <span class="n">Buffer</span><span class="p">{</span> <span class="k">get</span><span class="p">{</span> <span class="k">return</span> <span class="n">buffer</span><span class="p">;</span> <span class="p">}</span> <span class="k">set</span><span class="p">{</span> <span class="n">buffer</span><span class="p">=</span><span class="k">value</span><span class="p">;}</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">FixBoundary</span><span class="p">{</span> <span class="k">get</span><span class="p">{</span> <span class="k">return</span> <span class="n">fix_bnd</span><span class="p">;</span> <span class="p">}</span> <span class="k">set</span><span class="p">{</span> <span class="n">fix_bnd</span><span class="p">=</span><span class="k">value</span><span class="p">;}</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; Storage of grid data used for drawing &lt;/summary&gt;</span>
<span class="k">class</span> <span class="nc">Grid</span><span class="p">{</span>
    <span class="k">public</span> <span class="kt">double</span><span class="p">[]</span> <span class="n">xy</span><span class="p">;</span>                <span class="c1">//Coordinates in a raw array</span>
    <span class="k">public</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">edge_vert</span><span class="p">;</span>            <span class="c1">//Edge-&gt;Vertex connectivity in a raw array</span>
    <span class="k">public</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">bnd</span><span class="p">;</span>                  <span class="c1">//(bnd edge, bnd type) pairs in a raw array</span>
    <span class="k">public</span> <span class="n">Hybmesh</span><span class="p">.</span><span class="n">Grid2D</span> <span class="n">hm</span><span class="p">;</span>          <span class="c1">//handle used in UniteGrids operation</span>
    <span class="kt">double</span> <span class="n">_xmin</span><span class="p">,</span> <span class="n">_xmax</span><span class="p">,</span> <span class="n">_ymin</span><span class="p">,</span> <span class="n">_ymax</span><span class="p">;</span> <span class="c1">//Bounding Box</span>

    <span class="n">Grid</span><span class="p">(</span><span class="n">Hybmesh</span><span class="p">.</span><span class="n">Grid2D</span> <span class="n">descriptor</span><span class="p">){</span>
        <span class="n">hm</span> <span class="p">=</span> <span class="n">descriptor</span><span class="p">;</span>
        <span class="c1">//get data from hybmesh descriptor</span>
        <span class="n">xy</span> <span class="p">=</span> <span class="n">descriptor</span><span class="p">.</span><span class="n">RawVertices</span><span class="p">();</span>
        <span class="n">edge_vert</span> <span class="p">=</span> <span class="n">descriptor</span><span class="p">.</span><span class="n">RawTab</span><span class="p">(</span><span class="s">&quot;edge_vert&quot;</span><span class="p">);</span>
        <span class="n">bnd</span> <span class="p">=</span> <span class="n">descriptor</span><span class="p">.</span><span class="n">RawTab</span><span class="p">(</span><span class="s">&quot;bnd_bt&quot;</span><span class="p">);</span>
        <span class="c1">//bounding box</span>
        <span class="n">_xmin</span> <span class="p">=</span> <span class="n">xy</span><span class="p">[</span><span class="m">0</span><span class="p">];</span> <span class="n">_xmax</span> <span class="p">=</span> <span class="n">xy</span><span class="p">[</span><span class="m">0</span><span class="p">];</span> <span class="n">_ymin</span> <span class="p">=</span> <span class="n">xy</span><span class="p">[</span><span class="m">1</span><span class="p">];</span> <span class="n">_ymax</span> <span class="p">=</span> <span class="n">xy</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span> <span class="n">i</span><span class="p">&lt;</span><span class="n">xy</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="p">++</span><span class="n">i</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">xy</span><span class="p">[</span><span class="n">i</span><span class="p">]&lt;</span><span class="n">_xmin</span><span class="p">)</span> <span class="n">_xmin</span> <span class="p">=</span> <span class="n">xy</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">xy</span><span class="p">[</span><span class="n">i</span><span class="p">]&gt;</span><span class="n">_xmax</span><span class="p">)</span> <span class="n">_xmax</span> <span class="p">=</span> <span class="n">xy</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="n">xy</span><span class="p">[</span><span class="n">i</span><span class="p">]&lt;</span><span class="n">_ymin</span><span class="p">)</span> <span class="n">_ymin</span> <span class="p">=</span> <span class="n">xy</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="n">xy</span><span class="p">[</span><span class="n">i</span><span class="p">]&gt;</span><span class="n">_ymax</span><span class="p">)</span> <span class="n">_ymax</span> <span class="p">=</span> <span class="n">xy</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">/// &lt;summary&gt; Builds a grid from descriptor or returns null &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Grid</span> <span class="nf">Build</span><span class="p">(</span><span class="n">Hybmesh</span><span class="p">.</span><span class="n">Grid2D</span> <span class="n">descriptor</span><span class="p">){</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">descriptor</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">?</span> <span class="k">new</span> <span class="n">Grid</span><span class="p">(</span><span class="n">descriptor</span><span class="p">)</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; fills bounding box of the grid &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">BBox</span><span class="p">(</span><span class="k">out</span> <span class="kt">double</span> <span class="n">xmin</span><span class="p">,</span> <span class="k">out</span> <span class="kt">double</span> <span class="n">ymin</span><span class="p">,</span> <span class="k">out</span> <span class="kt">double</span> <span class="n">xmax</span><span class="p">,</span> <span class="k">out</span> <span class="kt">double</span> <span class="n">ymax</span><span class="p">){</span>
        <span class="n">xmin</span> <span class="p">=</span> <span class="n">_xmin</span><span class="p">;</span> <span class="n">ymin</span> <span class="p">=</span> <span class="n">_ymin</span><span class="p">;</span> <span class="n">xmax</span> <span class="p">=</span> <span class="n">_xmax</span><span class="p">;</span> <span class="n">ymax</span> <span class="p">=</span> <span class="n">_ymax</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; Holds hybmesh handle, grids and provides methods for grid manipulations &lt;/summary&gt;</span>
<span class="k">class</span> <span class="nc">Builder</span><span class="p">{</span>
    <span class="k">public</span> <span class="n">Hybmesh</span> <span class="n">hm</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Hybmesh</span><span class="p">();</span>
    <span class="k">public</span> <span class="n">Grid</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">result</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">GridProps</span> <span class="n">props_grid1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">GridProps</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
    <span class="k">public</span> <span class="n">GridProps</span> <span class="n">props_grid2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">GridProps</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">0.3</span><span class="p">,</span> <span class="m">0.3</span><span class="p">,</span> <span class="m">0.5</span><span class="p">,</span> <span class="m">0.5</span><span class="p">);</span>
    <span class="k">public</span> <span class="n">UniteProps</span> <span class="n">props_unite</span> <span class="p">=</span> <span class="k">new</span> <span class="n">UniteProps</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>

    <span class="c1">/// &lt;summary&gt; builds regular rectangular grid with defined boundary type &lt;/summary&gt;</span>
    <span class="n">Grid</span> <span class="nf">BuildGridB</span><span class="p">(</span><span class="n">GridProps</span> <span class="n">props</span><span class="p">,</span> <span class="kt">int</span> <span class="n">bnd</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">Grid</span><span class="p">.</span><span class="n">Build</span><span class="p">(</span><span class="n">hm</span><span class="p">.</span><span class="n">AddUnfRectGrid</span><span class="p">(</span>
            <span class="k">new</span> <span class="nf">P2</span><span class="p">(</span><span class="n">props</span><span class="p">.</span><span class="n">XMin</span><span class="p">,</span> <span class="n">props</span><span class="p">.</span><span class="n">YMin</span><span class="p">),</span> <span class="k">new</span> <span class="n">P2</span><span class="p">(</span><span class="n">props</span><span class="p">.</span><span class="n">XMax</span><span class="p">,</span> <span class="n">props</span><span class="p">.</span><span class="n">YMax</span><span class="p">),</span>
            <span class="n">props</span><span class="p">.</span><span class="n">Nx</span><span class="p">,</span> <span class="n">props</span><span class="p">.</span><span class="n">Ny</span><span class="p">,</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[]{</span><span class="n">bnd</span><span class="p">,</span> <span class="n">bnd</span><span class="p">,</span> <span class="n">bnd</span><span class="p">,</span> <span class="n">bnd</span><span class="p">}));</span>
    <span class="p">}</span>

    <span class="c1">// Fills this.g1/this.g2 grids or throws;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">BuildGrid1Operation</span><span class="p">(){</span>
        <span class="n">g1</span> <span class="p">=</span> <span class="n">BuildGridB</span><span class="p">(</span><span class="n">props_grid1</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">BuildGrid2Operation</span><span class="p">(){</span>
        <span class="n">g2</span> <span class="p">=</span> <span class="n">BuildGridB</span><span class="p">(</span><span class="n">props_grid2</span><span class="p">,</span> <span class="m">2</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// Fills this.result by union of g1 and g2. Rethrows exceptions if any.</span>
    <span class="c1">/// Signature fits ProgressBarExecutor.Exec requirements for visual callback.</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">UniteGridsOperation</span><span class="p">(</span><span class="n">Hybmesh</span><span class="p">.</span><span class="n">DCallback</span> <span class="n">cb</span><span class="p">){</span>
        <span class="k">try</span><span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">g1</span> <span class="p">==</span> <span class="k">null</span> <span class="p">||</span> <span class="n">g2</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="p">(</span>
                    <span class="s">&quot;Source grids have not been built yet&quot;</span><span class="p">);</span>
            <span class="n">hm</span><span class="p">.</span><span class="n">AssignCallback</span><span class="p">(</span><span class="n">cb</span><span class="p">);</span>
            <span class="n">result</span> <span class="p">=</span> <span class="n">Grid</span><span class="p">.</span><span class="n">Build</span><span class="p">(</span><span class="n">hm</span><span class="p">.</span><span class="n">UniteGrids1</span><span class="p">(</span><span class="n">g1</span><span class="p">.</span><span class="n">hm</span><span class="p">,</span> <span class="n">g2</span><span class="p">.</span><span class="n">hm</span><span class="p">,</span>
                <span class="n">props_unite</span><span class="p">.</span><span class="n">Buffer</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="n">props_unite</span><span class="p">.</span><span class="n">FixBoundary</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="n">hm</span><span class="p">.</span><span class="n">ResetCallback</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; Bounding box with respect to all existing grids &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">BBox</span><span class="p">(</span><span class="k">out</span> <span class="kt">double</span> <span class="n">xmin</span><span class="p">,</span> <span class="k">out</span> <span class="kt">double</span> <span class="n">ymin</span><span class="p">,</span> <span class="k">out</span> <span class="kt">double</span> <span class="n">xmax</span><span class="p">,</span> <span class="k">out</span> <span class="kt">double</span> <span class="n">ymax</span><span class="p">){</span>
        <span class="n">xmin</span><span class="p">=</span><span class="n">ymin</span><span class="p">=</span><span class="n">xmax</span><span class="p">=</span><span class="n">ymax</span><span class="p">=</span><span class="m">0</span><span class="p">;</span>
        <span class="c1">//calculate</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">g1</span> <span class="p">!=</span> <span class="k">null</span><span class="p">){</span>
            <span class="n">g1</span><span class="p">.</span><span class="n">BBox</span><span class="p">(</span><span class="k">out</span> <span class="n">xmin</span><span class="p">,</span> <span class="k">out</span> <span class="n">ymin</span><span class="p">,</span> <span class="k">out</span> <span class="n">xmax</span><span class="p">,</span> <span class="k">out</span> <span class="n">ymax</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">g2</span> <span class="p">!=</span> <span class="k">null</span><span class="p">){</span>
                <span class="kt">double</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">;</span>
                <span class="n">g2</span><span class="p">.</span><span class="n">BBox</span><span class="p">(</span><span class="k">out</span> <span class="n">x1</span><span class="p">,</span> <span class="k">out</span> <span class="n">y1</span><span class="p">,</span> <span class="k">out</span> <span class="n">x2</span><span class="p">,</span> <span class="k">out</span> <span class="n">y2</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">xmin</span> <span class="p">&gt;</span> <span class="n">x1</span><span class="p">)</span> <span class="n">xmin</span> <span class="p">=</span> <span class="n">x1</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">ymin</span> <span class="p">&gt;</span> <span class="n">y1</span><span class="p">)</span> <span class="n">ymin</span> <span class="p">=</span> <span class="n">y1</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">xmax</span> <span class="p">&lt;</span> <span class="n">x2</span><span class="p">)</span> <span class="n">xmax</span> <span class="p">=</span> <span class="n">x2</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="p">&lt;</span> <span class="n">y2</span><span class="p">)</span> <span class="n">ymax</span> <span class="p">=</span> <span class="n">x2</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">g2</span> <span class="p">!=</span> <span class="k">null</span><span class="p">){</span>
            <span class="n">g2</span><span class="p">.</span><span class="n">BBox</span><span class="p">(</span><span class="k">out</span> <span class="n">xmin</span><span class="p">,</span> <span class="k">out</span> <span class="n">ymin</span><span class="p">,</span> <span class="k">out</span> <span class="n">xmax</span><span class="p">,</span> <span class="k">out</span> <span class="n">ymax</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">namespace</span> <span class="nn">AppGui</span><span class="p">{</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// Provides static method to execute Action with popup progress-bar/cancel dialog</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">class</span> <span class="nc">ProgressBarExecutor</span><span class="p">{</span>
    <span class="c1">/// &lt;summary&gt; Needed to execute worker in background and do not hang gui &lt;/summary&gt;</span>
    <span class="k">class</span> <span class="nc">BGWorker</span><span class="p">:</span> <span class="n">BackgroundWorker</span><span class="p">{</span>
        <span class="n">ExecutorFunc</span> <span class="n">worker</span><span class="p">;</span>
        <span class="n">CBForm</span> <span class="n">reporter</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">Exception</span> <span class="n">result</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">BGWorker</span><span class="p">(</span><span class="n">ExecutorFunc</span> <span class="n">worker</span><span class="p">,</span> <span class="n">CBForm</span> <span class="n">reporter</span><span class="p">){</span>
            <span class="k">this</span><span class="p">.</span><span class="n">worker</span> <span class="p">=</span> <span class="n">worker</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">reporter</span> <span class="p">=</span> <span class="n">reporter</span><span class="p">;</span>
            <span class="n">WorkerSupportsCancellation</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="n">WorkerReportsProgress</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="n">DoWork</span> <span class="p">+=</span> <span class="n">Exec</span><span class="p">;</span>
            <span class="n">ProgressChanged</span> <span class="p">+=</span> <span class="n">Report</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnRunWorkerCompleted</span><span class="p">(</span><span class="n">RunWorkerCompletedEventArgs</span> <span class="n">e</span><span class="p">){</span>
            <span class="n">result</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">Result</span> <span class="k">as</span> <span class="n">Exception</span><span class="p">;</span>
            <span class="n">reporter</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">void</span> <span class="nf">Exec</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">DoWorkEventArgs</span> <span class="n">e</span><span class="p">){</span>
            <span class="k">try</span><span class="p">{</span>
                <span class="n">worker</span><span class="p">(</span><span class="n">reporter</span><span class="p">.</span><span class="n">Callback</span><span class="p">);</span>
                <span class="n">e</span><span class="p">.</span><span class="n">Result</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ee</span><span class="p">){</span>
                <span class="n">e</span><span class="p">.</span><span class="n">Result</span> <span class="p">=</span> <span class="n">ee</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">void</span> <span class="nf">Report</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">ProgressChangedEventArgs</span> <span class="n">a</span><span class="p">){</span>
            <span class="n">reporter</span><span class="p">.</span><span class="n">Report</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">UserState</span> <span class="k">as</span> <span class="n">Tuple</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="kt">double</span><span class="p">,</span> <span class="kt">double</span><span class="p">&gt;);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="c1">///&lt;summary&gt; Popup dialog form: 2 progress-bars + cancel button &lt;/summary&gt;</span>
    <span class="k">class</span> <span class="nc">CBForm</span><span class="p">:</span> <span class="n">Form</span><span class="p">{</span>
        <span class="n">ProgressBar</span> <span class="n">pb1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ProgressBar</span><span class="p">(),</span> <span class="n">pb2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ProgressBar</span><span class="p">();</span>
        <span class="n">TableLayoutPanel</span> <span class="n">layout</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TableLayoutPanel</span><span class="p">();</span>
        <span class="n">Label</span> <span class="n">lab1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Label</span><span class="p">(),</span> <span class="n">lab2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Label</span><span class="p">();</span>
        <span class="n">Button</span> <span class="n">cancel</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Button</span><span class="p">();</span>
        <span class="n">BGWorker</span> <span class="n">bg</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">Exception</span> <span class="n">ExecError</span> <span class="p">{</span> <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">bg</span><span class="p">.</span><span class="n">result</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>

        <span class="k">public</span> <span class="nf">CBForm</span><span class="p">(</span><span class="n">ExecutorFunc</span> <span class="n">worker</span><span class="p">){</span>
            <span class="n">Text</span> <span class="p">=</span> <span class="s">&quot;Hybmesh operation&quot;</span><span class="p">;</span>
            <span class="n">cancel</span><span class="p">.</span><span class="n">Anchor</span> <span class="p">=</span> <span class="n">lab1</span><span class="p">.</span><span class="n">Anchor</span> <span class="p">=</span> <span class="n">lab2</span><span class="p">.</span><span class="n">Anchor</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="n">lab1</span><span class="p">.</span><span class="n">TextAlign</span> <span class="p">=</span> <span class="n">lab2</span><span class="p">.</span><span class="n">TextAlign</span> <span class="p">=</span> <span class="n">ContentAlignment</span><span class="p">.</span><span class="n">MiddleCenter</span><span class="p">;</span>
            <span class="n">lab1</span><span class="p">.</span><span class="n">Width</span> <span class="p">=</span> <span class="n">lab2</span><span class="p">.</span><span class="n">Width</span> <span class="p">=</span> <span class="n">pb1</span><span class="p">.</span><span class="n">Width</span> <span class="p">=</span> <span class="n">pb2</span><span class="p">.</span><span class="n">Width</span> <span class="p">=</span> <span class="m">400</span><span class="p">;</span>
            <span class="n">pb1</span><span class="p">.</span><span class="n">Maximum</span> <span class="p">=</span> <span class="n">pb2</span><span class="p">.</span><span class="n">Maximum</span> <span class="p">=</span> <span class="m">100</span><span class="p">;</span>
            <span class="n">pb2</span><span class="p">.</span><span class="n">MarqueeAnimationSpeed</span> <span class="p">=</span> <span class="m">100</span><span class="p">;</span>
            <span class="n">cancel</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="s">&quot;Cancel&quot;</span><span class="p">;</span>
            <span class="n">cancel</span><span class="p">.</span><span class="n">Click</span> <span class="p">+=</span> <span class="n">OnCancel</span><span class="p">;</span>
            <span class="n">layout</span><span class="p">.</span><span class="n">AutoSize</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="n">layout</span><span class="p">.</span><span class="n">ColumnCount</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
            <span class="n">layout</span><span class="p">.</span><span class="n">RowCount</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
            <span class="n">layout</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">lab1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="n">layout</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">pb1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
            <span class="n">layout</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">lab2</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">2</span><span class="p">);</span>
            <span class="n">layout</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">pb2</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">3</span><span class="p">);</span>
            <span class="n">layout</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">cancel</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">4</span><span class="p">);</span>
            <span class="n">layout</span><span class="p">.</span><span class="n">Dock</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Forms</span><span class="p">.</span><span class="n">DockStyle</span><span class="p">.</span><span class="n">Fill</span><span class="p">;</span>
            <span class="n">AutoSize</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="n">AutoSizeMode</span> <span class="p">=</span> <span class="n">AutoSizeMode</span><span class="p">.</span><span class="n">GrowAndShrink</span><span class="p">;</span>
            <span class="n">Controls</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">layout</span><span class="p">);</span>
            <span class="n">FormBorderStyle</span> <span class="p">=</span> <span class="n">FormBorderStyle</span><span class="p">.</span><span class="n">FixedDialog</span><span class="p">;</span>
            <span class="n">CenterToScreen</span><span class="p">();</span>
            <span class="n">bg</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BGWorker</span><span class="p">(</span><span class="n">worker</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="n">bg</span><span class="p">.</span><span class="n">RunWorkerAsync</span><span class="p">();</span>  <span class="c1">//Start operation in background</span>
        <span class="p">}</span>
        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnFormClosing</span><span class="p">(</span><span class="n">FormClosingEventArgs</span> <span class="n">e</span><span class="p">){</span>
            <span class="n">bg</span><span class="p">.</span><span class="n">CancelAsync</span><span class="p">();</span> <span class="c1">//to stop on forced form close.</span>
        <span class="p">}</span>
        <span class="k">void</span> <span class="nf">OnCancel</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">){</span>
            <span class="n">bg</span><span class="p">.</span><span class="n">CancelAsync</span><span class="p">();</span> <span class="c1">//to stop on cancel click.</span>
        <span class="p">}</span>

        <span class="c1">//function passed as Hybmesh.DCallback</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="nf">Callback</span><span class="p">(</span><span class="kt">string</span> <span class="n">n1</span><span class="p">,</span> <span class="kt">string</span> <span class="n">n2</span><span class="p">,</span> <span class="kt">double</span> <span class="n">p1</span><span class="p">,</span> <span class="kt">double</span> <span class="n">p2</span><span class="p">){</span>
            <span class="c1">// Can not visualize input arguments from here</span>
            <span class="c1">// because we are in a separate thread. Instead we send a signal.</span>
            <span class="n">bg</span><span class="p">.</span><span class="n">ReportProgress</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="k">new</span> <span class="n">Tuple</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Double</span><span class="p">,</span> <span class="n">Double</span><span class="p">&gt;(</span>
                        <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">));</span>
            <span class="c1">//!!!!! Intentional delay for testing purpose.</span>
            <span class="n">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">500</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">bg</span><span class="p">.</span><span class="n">CancellationPending</span> <span class="p">?</span> <span class="m">1</span> <span class="p">:</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Fills form. Called from BGWorker in a gui thread.</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Report</span><span class="p">(</span><span class="n">Tuple</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Double</span><span class="p">,</span> <span class="n">Double</span><span class="p">&gt;</span> <span class="n">data</span><span class="p">){</span>
            <span class="n">lab1</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">Item1</span><span class="p">;</span> <span class="n">lab2</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">Item2</span><span class="p">;</span>
            <span class="n">pb1</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">data</span><span class="p">.</span><span class="n">Item3</span><span class="p">*</span><span class="m">100</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">Item4</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">){</span>
                <span class="n">pb2</span><span class="p">.</span><span class="n">Style</span> <span class="p">=</span> <span class="n">ProgressBarStyle</span><span class="p">.</span><span class="n">Marquee</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
                <span class="n">pb2</span><span class="p">.</span><span class="n">Style</span> <span class="p">=</span> <span class="n">ProgressBarStyle</span><span class="p">.</span><span class="n">Blocks</span><span class="p">;</span>
                <span class="n">pb2</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">data</span><span class="p">.</span><span class="n">Item4</span><span class="p">*</span><span class="m">100</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// Executes worker with popup progress bar form.</span>
    <span class="c1">/// Rethrows all exceptions. Throws Hybmesh.EUserInterrupt on cancellation request.</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">void</span> <span class="nf">Exec</span><span class="p">(</span><span class="n">ExecutorFunc</span> <span class="n">worker</span><span class="p">){</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dialog</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CBForm</span><span class="p">(</span><span class="n">worker</span><span class="p">)){</span>
            <span class="n">dialog</span><span class="p">.</span><span class="n">ShowDialog</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dialog</span><span class="p">.</span><span class="n">ExecError</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="k">throw</span> <span class="n">dialog</span><span class="p">.</span><span class="n">ExecError</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; Panel with automatic size and position adjustment. &lt;/summary&gt;</span>
<span class="k">class</span> <span class="nc">AppPanel</span><span class="p">:</span> <span class="n">Panel</span><span class="p">{</span>
    <span class="kt">double</span> <span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">xsz</span><span class="p">,</span> <span class="n">ysz</span><span class="p">;</span>
    <span class="c1">/// &lt;param name=&quot;xpos&quot;&gt; Horizontal location normalized to [0, 1]&lt;/param&gt;</span>
    <span class="c1">/// &lt;param name=&quot;ypos&quot;&gt; Vertical location normalized to [0, 1]&lt;/param&gt;</span>
    <span class="c1">/// &lt;param name=&quot;xsz&quot;&gt;  Panel width normalized to [0, 1] &lt;/param&gt;</span>
    <span class="c1">/// &lt;param name=&quot;ysz&quot;&gt;  Panel height normalized to [0, 1] &lt;/param&gt;</span>
    <span class="k">public</span> <span class="nf">AppPanel</span><span class="p">(</span><span class="n">Control</span> <span class="n">parent</span><span class="p">,</span>
            <span class="kt">double</span> <span class="n">xpos</span><span class="p">,</span> <span class="kt">double</span> <span class="n">ypos</span><span class="p">,</span> <span class="kt">double</span> <span class="n">xsz</span><span class="p">,</span> <span class="kt">double</span> <span class="n">ysz</span><span class="p">):</span> <span class="k">base</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="n">xpos</span> <span class="p">=</span> <span class="n">xpos</span><span class="p">;</span> <span class="k">this</span><span class="p">.</span><span class="n">ypos</span> <span class="p">=</span> <span class="n">ypos</span><span class="p">;</span> <span class="k">this</span><span class="p">.</span><span class="n">xsz</span> <span class="p">=</span> <span class="n">xsz</span><span class="p">;</span> <span class="k">this</span><span class="p">.</span><span class="n">ysz</span> <span class="p">=</span> <span class="n">ysz</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">BorderStyle</span> <span class="p">=</span> <span class="n">BorderStyle</span><span class="p">.</span><span class="n">Fixed3D</span><span class="p">;</span>
        <span class="n">parent</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="n">parent</span><span class="p">.</span><span class="n">Resize</span> <span class="p">+=</span> <span class="n">AutoResize</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">void</span> <span class="nf">AutoResize</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">x</span> <span class="p">=</span> <span class="n">Parent</span><span class="p">.</span><span class="n">ClientSize</span><span class="p">.</span><span class="n">Width</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">y</span> <span class="p">=</span> <span class="n">Parent</span><span class="p">.</span><span class="n">ClientSize</span><span class="p">.</span><span class="n">Height</span><span class="p">;</span>
        <span class="n">Location</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">x</span><span class="p">*</span><span class="n">xpos</span><span class="p">),</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">y</span><span class="p">*</span><span class="n">ypos</span><span class="p">));</span>
        <span class="n">Size</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Size</span><span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">x</span><span class="p">*</span><span class="n">xsz</span><span class="p">),</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">y</span><span class="p">*</span><span class="n">ysz</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; Options section: caption + properties + Apply button &lt;/summay&gt;</span>
<span class="k">class</span> <span class="nc">OptDisplay</span><span class="p">:</span> <span class="n">AppPanel</span><span class="p">{</span>
    <span class="n">Button</span> <span class="n">OkButton</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Button</span><span class="p">();</span>
    <span class="n">PropertyGrid</span> <span class="n">props</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PropertyGrid</span><span class="p">();</span>
    <span class="k">public</span> <span class="n">CheckBox</span> <span class="n">cap</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CheckBox</span><span class="p">();</span>

    <span class="c1">/// &lt;param name=&quot;Props&quot;&gt; Property structure for PropertyGrid widget&lt;/param&gt;</span>
    <span class="k">public</span> <span class="nf">OptDisplay</span><span class="p">(</span><span class="kt">string</span> <span class="n">caption</span><span class="p">,</span> <span class="kt">object</span> <span class="n">Props</span><span class="p">,</span>
            <span class="n">MainForm</span> <span class="n">parent</span><span class="p">,</span> <span class="kt">double</span> <span class="n">xpos</span><span class="p">,</span> <span class="kt">double</span> <span class="n">ypos</span><span class="p">,</span> <span class="kt">double</span> <span class="n">xsz</span><span class="p">,</span> <span class="kt">double</span> <span class="n">ysz</span><span class="p">)</span>
                <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">xsz</span><span class="p">,</span> <span class="n">ysz</span><span class="p">){</span>
        <span class="n">cap</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">caption</span><span class="p">;</span>
        <span class="n">cap</span><span class="p">.</span><span class="n">Checked</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="n">cap</span><span class="p">.</span><span class="n">CheckedChanged</span> <span class="p">+=</span> <span class="n">parent</span><span class="p">.</span><span class="n">RedrawCanvasHandler</span><span class="p">;</span>
        <span class="n">OkButton</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="s">&quot;Apply&quot;</span><span class="p">;</span>
        <span class="n">OkButton</span><span class="p">.</span><span class="n">Click</span> <span class="p">+=</span> <span class="n">parent</span><span class="p">.</span><span class="n">ApplyHandler</span><span class="p">;</span>
        <span class="n">OkButton</span><span class="p">.</span><span class="n">Click</span> <span class="p">+=</span> <span class="n">parent</span><span class="p">.</span><span class="n">RedrawCanvasHandler</span><span class="p">;</span>
        <span class="n">props</span><span class="p">.</span><span class="n">ToolbarVisible</span> <span class="p">=</span>  <span class="n">props</span><span class="p">.</span><span class="n">HelpVisible</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">props</span><span class="p">.</span><span class="n">PropertySort</span><span class="p">=</span><span class="n">PropertySort</span><span class="p">.</span><span class="n">NoSort</span><span class="p">;</span>
        <span class="n">props</span><span class="p">.</span><span class="n">Location</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">cap</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="n">Height</span><span class="p">);</span>
        <span class="n">props</span><span class="p">.</span><span class="n">SelectedObject</span> <span class="p">=</span> <span class="n">Props</span><span class="p">;</span>
        <span class="n">Controls</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>
        <span class="n">Controls</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">OkButton</span><span class="p">);</span>
        <span class="n">Controls</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">cap</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnResize</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">){</span>
        <span class="kt">var</span> <span class="n">s</span> <span class="p">=</span> <span class="n">ClientSize</span><span class="p">;</span>
        <span class="n">props</span><span class="p">.</span><span class="n">Size</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Size</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">Height</span><span class="p">-</span><span class="n">OkButton</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="n">Height</span><span class="p">-</span><span class="n">cap</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="n">Height</span><span class="p">);</span>
        <span class="n">OkButton</span><span class="p">.</span><span class="n">Location</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Width</span><span class="p">-</span><span class="n">OkButton</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span>
                          <span class="n">props</span><span class="p">.</span><span class="n">Location</span><span class="p">.</span><span class="n">Y</span><span class="p">+</span><span class="n">props</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="n">Height</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">///&lt;summary&gt; checks whether sender is this.ApplyButton &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsSender</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">){</span> <span class="k">return</span> <span class="n">Object</span><span class="p">.</span><span class="n">ReferenceEquals</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">OkButton</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt; Grid draw canvas &lt;/summary&gt;</span>
<span class="k">class</span> <span class="nc">Drawer</span><span class="p">:</span> <span class="n">AppPanel</span><span class="p">{</span>
    <span class="c1">//phisical bounding box of g1 and g2</span>
    <span class="kt">double</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">margin</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">CWidth</span><span class="p">{</span> <span class="k">get</span><span class="p">{</span> <span class="k">return</span> <span class="n">ClientSize</span><span class="p">.</span><span class="n">Width</span> <span class="p">-</span> <span class="m">2</span><span class="p">*</span><span class="n">margin</span><span class="p">;</span> <span class="p">}}</span>
    <span class="kt">int</span> <span class="n">CHeight</span><span class="p">{</span> <span class="k">get</span><span class="p">{</span> <span class="k">return</span> <span class="n">ClientSize</span><span class="p">.</span><span class="n">Height</span> <span class="p">-</span> <span class="m">2</span><span class="p">*</span><span class="n">margin</span><span class="p">;</span> <span class="p">}}</span>
    <span class="k">void</span> <span class="nf">AdjustBBox</span><span class="p">(){</span>
        <span class="p">((</span><span class="n">MainForm</span><span class="p">)</span><span class="n">Parent</span><span class="p">).</span><span class="n">builder</span><span class="p">.</span><span class="n">BBox</span><span class="p">(</span><span class="k">out</span> <span class="n">xmin</span><span class="p">,</span> <span class="k">out</span> <span class="n">ymin</span><span class="p">,</span> <span class="k">out</span> <span class="n">xmax</span><span class="p">,</span> <span class="k">out</span> <span class="n">ymax</span><span class="p">);</span>
        <span class="c1">//adjust bounding box to form sizes so that Lx/Ly == Width/Heigh</span>
        <span class="c1">//to keep aspect ratio.</span>
        <span class="kt">double</span> <span class="n">rel1</span> <span class="p">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">Size</span><span class="p">.</span><span class="n">Height</span><span class="p">/</span><span class="n">Size</span><span class="p">.</span><span class="n">Width</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">Ly</span> <span class="p">=</span> <span class="n">rel1</span> <span class="p">*</span> <span class="p">(</span><span class="n">xmax</span> <span class="p">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="p">-</span> <span class="p">(</span><span class="n">ymax</span> <span class="p">-</span> <span class="n">ymin</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">Lx</span> <span class="p">=</span> <span class="p">(</span><span class="n">ymax</span><span class="p">-</span><span class="n">ymin</span><span class="p">)/</span><span class="n">rel1</span> <span class="p">-</span> <span class="p">(</span><span class="n">xmax</span> <span class="p">-</span> <span class="n">xmin</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Ly</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">){</span>
            <span class="n">ymin</span> <span class="p">-=</span> <span class="n">Ly</span><span class="p">/</span><span class="m">2</span><span class="p">;</span> <span class="n">ymax</span> <span class="p">+=</span> <span class="n">Ly</span><span class="p">/</span><span class="m">2</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">xmin</span> <span class="p">-=</span> <span class="n">Lx</span><span class="p">/</span><span class="m">2</span><span class="p">;</span> <span class="n">xmax</span> <span class="p">+=</span> <span class="n">Lx</span><span class="p">/</span><span class="m">2</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//physical coordinates =&gt; canvas coordinates</span>
    <span class="kt">int</span> <span class="nf">XToCanvas</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">){</span> <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">CWidth</span><span class="p">*(</span><span class="n">x</span><span class="p">-</span><span class="n">xmin</span><span class="p">)/(</span><span class="n">xmax</span><span class="p">-</span><span class="n">xmin</span><span class="p">))</span> <span class="p">+</span> <span class="n">margin</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">int</span> <span class="nf">YToCanvas</span><span class="p">(</span><span class="kt">double</span> <span class="n">y</span><span class="p">){</span> <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">CHeight</span><span class="p">*(</span><span class="n">ymax</span><span class="p">-</span><span class="n">y</span><span class="p">)/(</span><span class="n">ymax</span><span class="p">-</span><span class="n">ymin</span><span class="p">))</span> <span class="p">+</span> <span class="n">margin</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">Drawer</span><span class="p">(</span><span class="n">Control</span> <span class="n">parent</span><span class="p">,</span> <span class="kt">double</span> <span class="n">xpos</span><span class="p">,</span> <span class="kt">double</span> <span class="n">ypos</span><span class="p">,</span> <span class="kt">double</span> <span class="n">xsz</span><span class="p">,</span> <span class="kt">double</span> <span class="n">ysz</span><span class="p">)</span>
            <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">xsz</span><span class="p">,</span> <span class="n">ysz</span><span class="p">){</span>
        <span class="n">BackColor</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">White</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//Draw grid edges. This is called from OnPaint(e).</span>
    <span class="k">void</span> <span class="nf">DrawGrid</span><span class="p">(</span><span class="n">Grid</span> <span class="n">g</span><span class="p">,</span> <span class="n">PaintEventArgs</span> <span class="n">e</span><span class="p">){</span>
        <span class="n">Graphics</span> <span class="n">X</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">Graphics</span><span class="p">;</span>
        <span class="n">Pen</span> <span class="n">pen0</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Pen</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Black</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span> <span class="c1">//internal edges</span>
        <span class="n">Pen</span> <span class="n">pen1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Pen</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Red</span><span class="p">,</span> <span class="m">2</span><span class="p">);</span>   <span class="c1">//bnd=1 edge pen</span>
        <span class="n">Pen</span> <span class="n">pen2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Pen</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Blue</span><span class="p">,</span> <span class="m">2</span><span class="p">);</span>  <span class="c1">//bnd=2 edge pen</span>
        <span class="c1">//internal edges</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span> <span class="n">i</span><span class="p">&lt;</span><span class="n">g</span><span class="p">.</span><span class="n">edge_vert</span><span class="p">.</span><span class="n">Length</span><span class="p">/</span><span class="m">2</span><span class="p">;</span> <span class="p">++</span><span class="n">i</span><span class="p">){</span>
            <span class="kt">int</span> <span class="n">v1</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">edge_vert</span><span class="p">[</span><span class="m">2</span><span class="p">*</span><span class="n">i</span><span class="p">],</span> <span class="n">v2</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">edge_vert</span><span class="p">[</span><span class="m">2</span><span class="p">*</span><span class="n">i</span><span class="p">+</span><span class="m">1</span><span class="p">];</span>
            <span class="n">X</span><span class="p">.</span><span class="n">DrawLine</span><span class="p">(</span><span class="n">pen0</span><span class="p">,</span> <span class="n">XToCanvas</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">xy</span><span class="p">[</span><span class="m">2</span><span class="p">*</span><span class="n">v1</span><span class="p">]),</span> <span class="n">YToCanvas</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">xy</span><span class="p">[</span><span class="m">2</span><span class="p">*</span><span class="n">v1</span><span class="p">+</span><span class="m">1</span><span class="p">]),</span>
                <span class="n">XToCanvas</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">xy</span><span class="p">[</span><span class="m">2</span><span class="p">*</span><span class="n">v2</span><span class="p">]),</span> <span class="n">YToCanvas</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">xy</span><span class="p">[</span><span class="m">2</span><span class="p">*</span><span class="n">v2</span><span class="p">+</span><span class="m">1</span><span class="p">]));</span>
        <span class="p">}</span>
        <span class="c1">//boundary edges</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">=</span><span class="m">0</span><span class="p">;</span> <span class="n">i</span><span class="p">&lt;</span><span class="n">g</span><span class="p">.</span><span class="n">bnd</span><span class="p">.</span><span class="n">Length</span><span class="p">/</span><span class="m">2</span><span class="p">;</span> <span class="p">++</span><span class="n">i</span><span class="p">){</span>
            <span class="kt">int</span> <span class="n">v1</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">edge_vert</span><span class="p">[</span><span class="m">2</span><span class="p">*</span><span class="n">g</span><span class="p">.</span><span class="n">bnd</span><span class="p">[</span><span class="m">2</span><span class="p">*</span><span class="n">i</span><span class="p">]],</span> <span class="n">v2</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">edge_vert</span><span class="p">[</span><span class="m">2</span><span class="p">*</span><span class="n">g</span><span class="p">.</span><span class="n">bnd</span><span class="p">[</span><span class="m">2</span><span class="p">*</span><span class="n">i</span><span class="p">]+</span><span class="m">1</span><span class="p">];</span>
            <span class="n">Pen</span> <span class="n">peni</span> <span class="p">=</span> <span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">bnd</span><span class="p">[</span><span class="m">2</span><span class="p">*</span><span class="n">i</span><span class="p">+</span><span class="m">1</span><span class="p">]</span> <span class="p">==</span> <span class="m">1</span> <span class="p">?</span> <span class="n">pen1</span> <span class="p">:</span> <span class="n">pen2</span><span class="p">);</span>
            <span class="n">X</span><span class="p">.</span><span class="n">DrawLine</span><span class="p">(</span><span class="n">peni</span><span class="p">,</span> <span class="n">XToCanvas</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">xy</span><span class="p">[</span><span class="m">2</span><span class="p">*</span><span class="n">v1</span><span class="p">]),</span> <span class="n">YToCanvas</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">xy</span><span class="p">[</span><span class="m">2</span><span class="p">*</span><span class="n">v1</span><span class="p">+</span><span class="m">1</span><span class="p">]),</span>
                <span class="n">XToCanvas</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">xy</span><span class="p">[</span><span class="m">2</span><span class="p">*</span><span class="n">v2</span><span class="p">]),</span> <span class="n">YToCanvas</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">xy</span><span class="p">[</span><span class="m">2</span><span class="p">*</span><span class="n">v2</span><span class="p">+</span><span class="m">1</span><span class="p">]));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnPaint</span><span class="p">(</span><span class="n">PaintEventArgs</span> <span class="n">e</span><span class="p">){</span>
        <span class="n">AppGui</span><span class="p">.</span><span class="n">MainForm</span> <span class="n">b</span> <span class="p">=</span> <span class="p">(</span><span class="n">AppGui</span><span class="p">.</span><span class="n">MainForm</span><span class="p">)</span><span class="n">Parent</span><span class="p">;</span>
        <span class="n">AdjustBBox</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">VisibleGrid1</span><span class="p">)</span> <span class="n">DrawGrid</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="n">g1</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">VisibleGrid2</span><span class="p">)</span> <span class="n">DrawGrid</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="n">g2</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">VisibleResult</span><span class="p">)</span> <span class="n">DrawGrid</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="n">result</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">MainForm</span><span class="p">:</span> <span class="n">Form</span><span class="p">{</span>
    <span class="k">public</span> <span class="n">Builder</span> <span class="n">builder</span><span class="p">;</span>
    <span class="n">Drawer</span> <span class="n">canvas</span><span class="p">;</span>
    <span class="n">OptDisplay</span> <span class="n">gui_grid1</span><span class="p">,</span> <span class="n">gui_grid2</span><span class="p">,</span> <span class="n">gui_unite</span><span class="p">;</span>

    <span class="c1">// if grid1/grid2/result grid should be drawn.</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">VisibleGrid1</span><span class="p">{</span><span class="k">get</span><span class="p">{</span><span class="k">return</span> <span class="n">gui_grid1</span><span class="p">.</span><span class="n">cap</span><span class="p">.</span><span class="n">Checked</span> <span class="p">&amp;&amp;</span> <span class="n">builder</span><span class="p">.</span><span class="n">g1</span> <span class="p">!=</span> <span class="k">null</span><span class="p">;}}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">VisibleGrid2</span><span class="p">{</span><span class="k">get</span><span class="p">{</span><span class="k">return</span> <span class="n">gui_grid2</span><span class="p">.</span><span class="n">cap</span><span class="p">.</span><span class="n">Checked</span> <span class="p">&amp;&amp;</span> <span class="n">builder</span><span class="p">.</span><span class="n">g2</span> <span class="p">!=</span> <span class="k">null</span><span class="p">;}}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">VisibleResult</span><span class="p">{</span><span class="k">get</span><span class="p">{</span><span class="k">return</span> <span class="n">gui_unite</span><span class="p">.</span><span class="n">cap</span><span class="p">.</span><span class="n">Checked</span> <span class="p">&amp;&amp;</span> <span class="n">builder</span><span class="p">.</span><span class="n">result</span> <span class="p">!=</span> <span class="k">null</span><span class="p">;}}</span>

    <span class="k">public</span> <span class="nf">MainForm</span><span class="p">(</span><span class="n">Builder</span> <span class="n">builder</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="n">builder</span> <span class="p">=</span> <span class="n">builder</span><span class="p">;</span>
        <span class="n">canvas</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Drawer</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0.7</span><span class="p">,</span> <span class="m">1.0</span><span class="p">);</span>
        <span class="n">gui_grid1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">OptDisplay</span><span class="p">(</span><span class="s">&quot;Basic grid&quot;</span><span class="p">,</span> <span class="n">builder</span><span class="p">.</span><span class="n">props_grid1</span><span class="p">,</span>
                <span class="k">this</span><span class="p">,</span> <span class="m">0.7</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0.3</span><span class="p">,</span> <span class="m">0.4</span><span class="p">);</span>
        <span class="n">gui_grid2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">OptDisplay</span><span class="p">(</span><span class="s">&quot;Secondary grid&quot;</span><span class="p">,</span> <span class="n">builder</span><span class="p">.</span><span class="n">props_grid2</span><span class="p">,</span>
                <span class="k">this</span><span class="p">,</span> <span class="m">0.7</span><span class="p">,</span> <span class="m">0.4</span><span class="p">,</span> <span class="m">0.3</span><span class="p">,</span> <span class="m">0.4</span><span class="p">);</span>
        <span class="n">gui_unite</span> <span class="p">=</span> <span class="k">new</span> <span class="n">OptDisplay</span><span class="p">(</span><span class="s">&quot;Unite&quot;</span><span class="p">,</span> <span class="n">builder</span><span class="p">.</span><span class="n">props_unite</span><span class="p">,</span>
                    <span class="k">this</span><span class="p">,</span> <span class="m">0.7</span><span class="p">,</span> <span class="m">0.8</span><span class="p">,</span> <span class="m">0.3</span><span class="p">,</span> <span class="m">0.2</span><span class="p">);</span>
        <span class="n">Text</span> <span class="p">=</span> <span class="s">&quot;HybMesh/c# unite grids demo&quot;</span><span class="p">;</span>
        <span class="n">Size</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Size</span><span class="p">(</span><span class="m">700</span><span class="p">,</span> <span class="m">500</span><span class="p">);</span>
        <span class="n">CenterToScreen</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; Called by apply click. Launches builders, shows error messages &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">ApplyHandler</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">){</span>
        <span class="k">try</span><span class="p">{</span>
            <span class="c1">// Choose operation by checking who called it.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">gui_grid1</span><span class="p">.</span><span class="n">IsSender</span><span class="p">(</span><span class="n">sender</span><span class="p">)){</span>
                <span class="n">builder</span><span class="p">.</span><span class="n">BuildGrid1Operation</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">gui_grid2</span><span class="p">.</span><span class="n">IsSender</span><span class="p">(</span><span class="n">sender</span><span class="p">)){</span>
                <span class="n">builder</span><span class="p">.</span><span class="n">BuildGrid2Operation</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">gui_unite</span><span class="p">.</span><span class="n">IsSender</span><span class="p">(</span><span class="n">sender</span><span class="p">)){</span>
                <span class="n">ProgressBarExecutor</span><span class="p">.</span><span class="n">Exec</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">UniteGridsOperation</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Hybmesh</span><span class="p">.</span><span class="n">EUserInterrupt</span><span class="p">){</span>
            <span class="n">MessageBox</span><span class="p">.</span><span class="n">Show</span><span class="p">(</span><span class="s">&quot;Interrupted&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">MessageBoxButtons</span><span class="p">.</span><span class="n">OK</span><span class="p">,</span>
                    <span class="n">MessageBoxIcon</span><span class="p">.</span><span class="n">Information</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Hybmesh</span><span class="p">.</span><span class="n">ERuntimeError</span> <span class="n">ee</span><span class="p">){</span>
            <span class="n">MessageBox</span><span class="p">.</span><span class="n">Show</span><span class="p">(</span><span class="n">ee</span><span class="p">.</span><span class="n">Message</span><span class="p">,</span> <span class="s">&quot;Hybmesh error&quot;</span><span class="p">,</span> <span class="n">MessageBoxButtons</span><span class="p">.</span><span class="n">OK</span><span class="p">,</span>
                    <span class="n">MessageBoxIcon</span><span class="p">.</span><span class="n">Error</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ee</span><span class="p">){</span>
            <span class="n">MessageBox</span><span class="p">.</span><span class="n">Show</span><span class="p">(</span><span class="n">ee</span><span class="p">.</span><span class="n">Message</span><span class="p">,</span> <span class="s">&quot;Applicaton error&quot;</span><span class="p">,</span> <span class="n">MessageBoxButtons</span><span class="p">.</span><span class="n">OK</span><span class="p">,</span>
                    <span class="n">MessageBoxIcon</span><span class="p">.</span><span class="n">Error</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">RedrawCanvasHandler</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">){</span>
        <span class="n">canvas</span><span class="p">.</span><span class="n">Invalidate</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">C# Bindings for HybMesh</a><ul>
<li><a class="reference internal" href="#usage">Usage</a></li>
<li><a class="reference internal" href="#helloworld-example">Helloworld Example</a></li>
<li><a class="reference internal" href="#introductory-example">Introductory Example</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ooimatlab.html"
                        title="previous chapter">Matlab Bindings for HybMesh</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="fileformats.html"
                        title="next chapter">Native File Formats</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/ooics.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="fileformats.html" title="Native File Formats"
             >next</a> |</li>
        <li class="right" >
          <a href="ooimatlab.html" title="Matlab Bindings for HybMesh"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">HybMesh 0.5.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="oointerface.html" >High-Level Programming Interfaces</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, KalininEI.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3.
    </div>
  </body>
</html>